% 080618
% Helen Cai
% Call this script from the GUI to launch application of YOLO object 
% recognition to FishOASIS data set.  
% Dependent on git from https://github.com/ignacio-rocco/yolomex
% and a set of custom weights that must be trained in order to recognize
% fish. 

cd('yolomex')

datacfg = fullfile(pwd,'darknet/cfg/coco.data');
cfgfile = fullfile(pwd,'darknet/cfg/tiny-yolo.cfg');

% Import weights to be used for detection. Modify this line once fish are
% added to the detection classes. 
weightfile = fullfile(pwd,'tiny-yolo.weights');

% Initialize YOLO
yolomex('init',datacfg,cfgfile,weightfile)
threshold = 0.05;
hier_threshold = 0.15;

% Iterate through images in directory
files = dir(fullfile(char(handles.data_dir), '*jpg'));
for i = 1:length(files)
    files(i).name
    target_image = imread(handles.data_dir, files(i).name )
    detections=yolomex('detect', target_image, threshold, hier_threshold)
end


% Get image and read detection
target_image = imread(fullfile(image_dir, 'many_cats.jpg'));
detections=yolomex('detect', target_image, threshold, hier_threshold);

cd('..')
